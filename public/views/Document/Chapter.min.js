var NewChapter=function(n){var b=n.Language,c=!0,m=$("#idChapterMsg"),k=function(c,b){var a="<div class='alert ";m.html((1==b?a+"alert-info":2==b?a+"alert-warning":3==b?a+"alert-danger":a+"alert-success")+("' role='alert'>"+c+"</div>"));m.show("fast")},p=$("#idChapterBodyView"),q=$("#idChapterBodyHide");$("#idChapterHide").click(function(b){q.toggle("fast");p.toggle("fast")});var t=function(){var b=$("#idBtnSort"),c=$("#idModalSortBody");c.sortable().disableSelection();var a=$("#idModalSortSure"),
e=$("#idModalSortCancel"),f=null,d=null;a.click(function(a){e.click();if(f){var b=[],h=!1;c.children("li").each(function(a,e){var c=$(e).data("id");b.push({Id:c,Sort:a});h||c==d[a].Id||(h=!0)});h&&f(b)}});return{Show:function(a,e){d=a;f=e;for(var h="",r=0;r<a.length;r++)var g=a[r],h=h+("<li class='list-group-item' data-id='"+g.Id+"'>"+g.Name+"</li>");c.html(h);b.click()}}}();(function(){var p=function(a,e){if(c){c=!1;var f=b["new name"];$.ajax({url:"/Chapter/AjaxNew",type:"POST",dataType:"json",data:{doc:n.Id,
name:f}}).done(function(d){0==d.Code?(d=a.create_node(e,{id:d.Value,parent:"0",text:f}),a.edit(d)):k(d.Emsg,3)}).fail(function(){k(b["err net"],3)}).always(function(){c=!0})}},q=function(a,e){if(c){for(var f=[],d=0;d<e.children.length;++d){var l=a.get_node(e.children[d]);f.push({Id:l.id,Name:l.text})}t.Show(f,function(d){if(c){c=!1;a.set_icon(e,"/public/img/throbber.gif");m.hide("fast");var f=JSON.stringify(d);$.ajax({url:"/Chapter/AjaxSort",type:"POST",dataType:"json",data:{str:f}}).done(function(b){if(0==
b.Code){for(b=0;b<d.length;b++){var c=d[b];a.get_node(c.Id).data=c.Sort}a.close_node(e);a.sort(e);a.open_node(e)}else k(b.Emsg,3)}).fail(function(){k(b["err net"],3)}).always(function(){a.set_icon(e);c=!0})}})}};$("#idChapterTree").jstree({plugins:["conditionalselect","contextmenu","sort"],conditionalselect:function(){this.deselect_all(!0);return!0},contextmenu:{items:function(a){var e=this;return"0"==a.id?{create:{label:b["menu new"],icon:"/public/img/add_16px.ico",action:function(){p(e,a)}},sort:{label:b["menu sort"],
icon:"/public/img/sort_16px.ico",separator_before:!0,action:function(){q(e,a)}}}:{view:{label:b["menu view"],icon:"/public/img/cloud_16px.ico",action:function(){window.open("/Chapter?id="+a.id)}},edit:{label:b["menu edit"],icon:"/public/img/wrench_16px.ico",action:function(){window.open("/Edit?id="+a.id)}},rename:{label:b["menu rename"],icon:"/public/img/why_16px.ico",separator_before:!0,action:function(){c&&e.edit(a)}},remove:{label:b["menu remove"],icon:"/public/img/close_16px.ico",separator_before:!0,
action:function(){}}}}},sort:function(a,b){var c=this.get_node(a),d=this.get_node(b);return c.data>d.data?1:-1},core:{check_callback:!0,data:n.Data}}).on("rename_node.jstree",function(a,e){var f=$(this).jstree(!0),d=e.node,l=e.text,g=e.old;l!=g&&(c?(c=!1,f.set_icon(d,"/public/img/throbber.gif"),m.hide("fast"),$.ajax({url:"/Chapter/AjaxRename",type:"POST",dataType:"json",data:{id:d.id,name:l}}).done(function(a){0!=a.Code&&(k(a.Emsg,3),f.set_text(d,g))}).fail(function(){k(b["err net"],3);f.set_text(d,
g)}).always(function(){f.set_icon(d);c=!0})):f.set_text(d,g))})})()};
