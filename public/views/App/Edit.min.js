var $jscomp={scope:{},findInternal:function(a,b,h){a instanceof String&&(a=String(a));for(var r=a.length,k=0;k<r;k++){var g=a[k];if(b.call(h,g,k,a))return{i:k,v:g}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,h){if(h.get||h.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=h.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,b,h,r){if(b){h=$jscomp.global;a=a.split(".");for(r=0;r<a.length-1;r++){var k=a[r];k in h||(h[k]={});h=h[k]}a=a[a.length-1];r=h[a];b=b(r);b!=r&&null!=b&&$jscomp.defineProperty(h,a,{configurable:!0,writable:!0,value:b})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(b,a){return $jscomp.findInternal(this,b,a).v}},"es6-impl","es3");
var NewContext=function(a){var b=a.Language,h=function(){var b=$("#idBtnSort"),a=$("#idModalSortBody");a.sortable().disableSelection();var e=$("#idModalSortSure"),f=$("#idModalSortCancel"),d=null,l=null;e.click(function(b){f.click();if(d){var e=[],c=!1;a.children("li").each(function(b,a){var d=$(a).data("id");e.push(d);c||d==l[b].Id||(c=!0)});c&&d(e)}});return{Show:function(c,e){l=c;d=e;for(var p="",v=0;v<c.length;v++)var f=c[v],p=p+("<li class='list-group-item' data-id='"+f.Id+"'>"+f.Name+"</li>");
a.html(p);b.click()}}}(),r=function(){var b=$("#idBtnModalInput"),a=$("#idModalInputTitle"),e=$("#idModalInputBody"),f=$("#idModalInputSure"),d=$("#idModalInputCancel"),l=null,g={Show:function(c,d,f){f&&(l=f);a.html(c);e.val(d);b.click();setTimeout(function(){e.select().focus()},200)},Hide:function(){d.click()}},q=function(){if(l){var b=e.val();l(g,b)}else d.click()};f.click(function(b){q()});e.keydown(function(b){13==b.keyCode&&q()});return g}(),k=function(){var b=$("#idBtnModalTextarea"),a=$("#idModalTextareaTitle"),
e=$("#idModalTextareaBody"),f=$("#idModalTextareaSure"),d=$("#idModalTextareaCancel"),l=null,g={Show:function(c,d,f){f&&(l=f);a.html(c);e.val(d);b.click();setTimeout(function(){e.select().focus()},200)},Hide:function(){d.click()},Reset:function(){e.val("")}};f.click(function(b){l?(b=e.val(),l(g,b)):d.click()});return g}(),g=function(){var b=$("#idBtnModalMsg"),a=$("#idModalMsgTitle"),e=$("#idModalMsgBody"),f=$("#idModalMsgSure"),d=$("#idModalMsgCancel"),g=null,h={Show:function(d,c,f){f&&(g=f);a.html(d);
e.html(c);b.click()},Hide:function(){d.click()}};f.click(function(b){g?g(h):d.click()});return h}(),D=kingui,u=1,z=function(a){var c=null,e={Hide:function(){f.Hide()},Show:function(b,a,e){c=e;f.Show(b,a)}},f=D.NewMsg({Id:a,Btns:[{Name:b.Sure,Callback:function(){c?c.bind(e)():this.Hide()}},{Name:b.Cancel}]});return e}(u++);KindEditor.plugin("mycode",function(a){var c=this;c.clickToolbar("mycode",function(){k.Show(b["input code"],"",function(b,a){b.Hide();a=$.trim(a);if(""!=a){var d=a,e=document.createElement("div"),
d=document.createTextNode(d);e.appendChild(d);a="<pre class='prettyprint linenums'>"+e.innerHTML+"</pre>";c.insertHtml(a)}})})});KindEditor.lang({mycode:b["insert code"]});var G=function(a,v){var e=0,c=$("#idPanelsView"),d=$("<div class='panel panel-default'><a name='panel-"+a+"'></a><div class='panel-heading'><span class='glyphicon glyphicon-asterisk kBtnSpan kBtnTop'></span><span class='glyphicon glyphicon-minus kBtnSpan kBtnMenuHide'></span><span class='glyphicon glyphicon-sort-by-attributes kBtnSpan kBtnMenuSort'></span><span class='kPanelName'>"+
v+"</span></div><div class='panel-body'><div class='kPanelHide' style='display: none;'>"+b["data is hide"]+"</div><div class='kPanelBody'><div class='kPanelBodyView'>"+b["wait init data"]+"</div><div class='kSectionNode'><span class='glyphicon glyphicon-plus kBtnSpan kBtnAddSection'></span></div></div></div></div>");c.append(d);var l=d.find(".kPanelName:first"),k=d.find(".kPanelHide:first"),q=d.find(".kPanelBody:first"),p=q.find(".kPanelBodyView:first"),n=d.find(".kBtnAddSection:first");n.hide();
var t=[],m=function(a,c,d){var x={Id:a,Name:c};t.push(x);var f="king-section-"+a,m=$("<div id='"+f+"'><h4 class='kSectionTitle'><span class='glyphicon glyphicon-minus kBtnSpan'></span><span class='glyphicon glyphicon-wrench kBtnSpan'></span><span class='glyphicon glyphicon-remove kBtnSpan'></span><span class='kTitleName'>"+c+"</span></h4><div class='kSectionHide'>"+b["data is hide"]+"</div><div class='kSectionBody'><div class='kSectionViewStatus'><span class='glyphicon glyphicon-wrench kBtnSpan'></span><span class='glyphicon glyphicon-save kBtnSpan'></span><span class='kSectionSaveStatus'>"+
b["section ok"]+"</span></div><div class='kSectionView'></div><div class='kSectionEdit'><textarea class='kEditor'></textarea></div></div></div>"),A=m.find(".kSectionTitle:first"),E=A.find(".kTitleName:first"),h=m.find(".kSectionHide:first"),F=m.find(".kSectionBody:first"),l=m.find(".kSectionViewStatus:first"),k=m.find(".kSectionView:first"),v=m.find(".kSectionEdit:first");p.append(m);var q=l.find(".kSectionSaveStatus:first"),n={ShowPreview:function(b){v.hide();k.html(b);k.show();prettyPrint()},Save:function(c){if(d==
c)g.Show(b["warning.title"],b["data not need save"]);else{var e=this;$.ajax({url:"/Section/AjaxSave",type:"POST",dataType:"json",data:{id:a,val:c}}).done(function(a){0==a.Code?(d=c,e.UpdateStatus()):g.Show(b["err.title"],a.Emsg)}).fail(function(){g.Show(b["err.title"],b["err net"])})}},UpdateStatus:function(a){a||""==a?a==d?q.text(b["section ok"]):q.text(b["section no"]):q.text(b["section ok"])}},m=v.find(".kEditor");(d||""==d)&&m.val(d);var u=KindEditor.create(m,{uploadJson:"/Files/Upload?id="+a,
fileManagerJson:"/Files/Find?id="+a,allowFileManager:!0,urlType:"relative",resizeType:1,width:"100%",height:400,items:["source","|","undo","redo","|","mycode","|","cut","copy","paste","plainpaste","|","justifyleft","justifycenter","justifyright","justifyfull","insertorderedlist","insertunorderedlist","indent","outdent","subscript","superscript","clearhtml","selectall","|","fullscreen","/","bold","italic","underline","strikethrough","lineheight","removeformat","|","image","insertfile","table","link",
"unlink",,],afterCreate:function(){n._isCreate=!0},afterChange:function(){if(n._isCreate){var b=this.html();n.UpdateStatus(b)}}});u._k_ctx=n;d||""==d?n.ShowPreview(d):d="";var w=function(d){c!=d&&1==e&&(e=2,$.ajax({url:"/Section/AjaxRename",type:"POST",dataType:"json",data:{id:a,name:d}}).done(function(a){0==a.Code?(c=d,E.text(c),x.Name=c):g.Show(b["err.title"],a.Emsg)}).fail(function(){g.Show(b["err.title"],b["err net"])}).always(function(){e=1}))},y=function(c){1==e&&(e=2,$.ajax({url:"/Section/AjaxRemove",
type:"POST",dataType:"json",data:{id:a}}).done(function(c){if(0==c.Code){p.find("#"+f).remove();c=[];for(var d=0;d<t.length;d++)t[d].Id!=a&&c.push(t[d]);t=c}else z.Show(b["err.title"],c.Emsg)}).fail(function(){z.Show(b["err.title"],b["err net"])}).always(function(){e=1}))};A.find(".glyphicon-minus:first").click(function(b){h.toggle("fast");F.toggle("fast")});A.find(".glyphicon-wrench:first").click(function(a){r.Show(b["input section"],c,function(b,a){b.Hide();w(a)})});A.find(".glyphicon-remove:first").click(function(d){g.Show(b["msg warning"],
b["chapter erase"]+" - "+c+"<br>"+b["sure?"],function(b){b.Hide();y(a)})});l.find(".glyphicon-wrench:first").click(function(b){k.is(":visible")?(k.html(""),k.hide(),v.show()):(b=u.html(),n.ShowPreview(b))});l.find(".glyphicon-save:first").click(function(b){b=u.html();n.Save(b)})},x=function(a){t=[];$.ajax({url:"/Section/AjaxFind",type:"POST",dataType:"json",data:{panel:a}}).done(function(b){if(0==b.Code){p.html("");if(b=b.Data)for(var a=0;a<b.length;a++){var c=b[a];m(c.Id,c.Name,c.Str)}n.show();e=
1}else p.html(b.Emsg)}).fail(function(){p.html(b["err net"])})};x(a);d.find(".kBtnTop:first").click(function(b){location.href="#top"});d.find(".kBtnMenuHide:first").click(function(b){k.toggle("fast");q.toggle("fast")});d.find(".kBtnMenuSort:first").click(function(c){1==e&&0!=t.length&&h.Show(t,function(c){1==e&&(e=2,c=c.join("-"),$.ajax({url:"/Section/AjaxSort",type:"POST",dataType:"json",data:{sort:c}}).done(function(c){0==c.Code?(p.html(b["wait init data"]),x(a)):g.Show(b["err.title"],c.Emsg)}).fail(function(){g.Show(b["err.title"],
b["err net"])}).always(function(){e=1}))})});n.click(function(c){if(1==e){var d=b["new section"];e=2;$.ajax({url:"/Section/AjaxNew",type:"POST",dataType:"json",data:{panel:a,name:d}}).done(function(a){0==a.Code?m(a.Value,d):g.Show(b["err.title"],a.Emsg)}).fail(function(){g.Show(b["err.title"],b["err net"])}).always(function(){e=1})}});return{Rename:function(b){l.text(b)},Remove:function(){d.remove()}}},u=function(){var c=!0,h=$("#idBtnToggle"),e=$("#idBodyHide"),f=$("#idBodyView");h.click(function(b){e.toggle("fast");
f.toggle("jqView")});var d=$("#idListPanel"),l=[],k=function(){var b={};d.children("li").each(function(a,c){var d=$(c),e=d.attr("id");b[e]=d});for(var a=0;a<l.length;a++)d.append(b[l[a]])};d.sortable({update:function(a,e){if(!c)return!1;var m=d.sortable("toArray"),f=m.join("-");c=!1;$.ajax({url:"/Panel/AjaxSort",type:"POST",dataType:"json",data:{sort:f}}).done(function(a){0==a.Code?l=m:(k(),g.Show(b["err.title"],a.Emsg))}).fail(function(){k();g.Show(b["err.title"],b["err net"])}).always(function(){c=
!0})}}).disableSelection();var q=null,p=null,n=null,t=function(a,e){l.push(a);var f=$("<li class='list-group-item' id='"+a+"'><span data-id='"+a+"' class='glyphicon glyphicon-wrench kBtnSpan'></span><span data-id='"+a+"' class='glyphicon glyphicon-remove kBtnSpan'></span><a href='#panel-"+a+"'>"+e+"</a></li>"),m=f.find("a:first");d.append(f);q&&q(a,e);var h=function(d){d!=e&&c&&(c=!1,$.ajax({url:"/Panel/AjaxRename",type:"POST",dataType:"json",data:{id:a,name:d}}).done(function(c){0==c.Code?(e=d,m.text(e),
p&&p(a,e)):g.Show(b["err.title"],c.Emsg)}).fail(function(){g.Show(b["err.title"],b["err net"])}).always(function(){c=!0}))},k=function(a){c&&(c=!1,$.ajax({url:"/Panel/AjaxRemove",type:"POST",dataType:"json",data:{id:a}}).done(function(c){0==c.Code?(n&&n(a,e),f.remove()):z.Show(b["err.title"],c.Emsg)}).fail(function(){z.Show(b["err.title"],b["err net"])}).always(function(){c=!0}))};f.find(".glyphicon-wrench").click(function(a){r.Show(b["input chapter"],e,function(b,a){b.Hide();h(a)})});f.find(".glyphicon-remove").click(function(c){g.Show(b["msg warning"],
b["panel erase"]+" - "+e+"<br>"+b["sure?"],function(b){b.Hide();k(a)})})};$("#idBtnNewPanel").click(function(d){if(c){c=!1;var e=b["new panel"];$.ajax({url:"/Panel/AjaxNew",type:"POST",dataType:"json",data:{chapter:a.Chapter.Id,name:e}}).done(function(a){0==a.Code?t(a.Value,e):g.Show(b["err.title"],a.Emsg)}).fail(function(){g.Show(b["err.title"],b["err net"])}).always(function(){c=!0})}});return{Bind:function(a,b){"item.new"==a?q=b:"item.rename"==a?p=b:"item.remove"==a&&(n=b)},New:function(a,b){t(a,
b)}}}(),w={};u.Bind("item.new",function(a,b){w[a]=G(a,b)});u.Bind("item.rename",function(a,b){w[a].Rename(b)});u.Bind("item.remove",function(a,b){w[a].Remove();delete w[a]});for(var B=a.Panels,y=0;y<B.length;y++){var C=B[y];u.New(C.Id,C.Name)}};
