var $jscomp={scope:{},findInternal:function(a,c,b){a instanceof String&&(a=String(a));for(var d=a.length,g=0;g<d;g++){var m=a[g];if(c.call(b,m,g,a))return{i:g,v:m}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,b){if(b.get||b.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[c]=b.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,c,b,d){if(c){b=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var g=a[d];g in b||(b[g]={});b=b[g]}a=a[a.length-1];d=b[a];c=c(d);c!=d&&null!=c&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:c})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6-impl","es3");
var NewContext=function(a){var c=a.Language,b=!0,d=kingui,g=function(a){var b=null,f={Hide:function(){e.Hide()},Show:function(a,c,f){b=f;e.Show(a,c)}},e=d.NewMsg({Id:a,Btns:[{Name:c.Sure,Callback:function(){b?b.bind(f)():this.Hide()}},{Name:c.Cancel}]});return f},m=function(){var a=$("#idBtnSort"),c=$("#idModalSortBody");c.sortable().disableSelection();var b=$("#idModalSortSure"),e=$("#idModalSortCancel"),p=null,h=null;b.click(function(a){e.click();if(p){var b=[],f=!1;c.children("li").each(function(a,
c){var e=$(c).data("id");b.push(e);f||e==h[a].Id||(f=!0)});f&&p(b)}});return{Show:function(b,f){h=b;p=f;for(var e="",k=0;k<b.length;k++)var l=b[k],e=e+("<li class='list-group-item' data-id='"+l.Id+"'>"+l.Name+"</li>");c.html(e);a.click()}}}(),w=1,A=g(w++),n=g(w++),x=function(){var b=null,l=null;$("#idTagTree").hide().jstree({plugins:["conditionalselect","contextmenu","sort"],conditionalselect:function(){this.deselect_all(!0);return!0},contextmenu:{items:function(a){var e=this,f={search:{label:c["search tag"],
icon:"/public/img/book_16px.ico",action:function(){b&&b(e,a)}}};e.is_leaf(a)||(f.toggle={label:c["toggle tag"],icon:"/public/img/attachment_16px.ico",separator_before:!0,action:function(){e.toggle_node(a)}});return f}},sort:function(a,b){var c=this.get_node(a),f=this.get_node(b);return c.data.Sort>f.data.Sort?1:-1},core:{check_callback:!0,data:a.Data}}).on("ready.jstree",function(){$(this).show();l=$(this).jstree(!0)}).on("select_node.jstree",function(a,c){var f=$(this).jstree(!0),e=c.node;!f.is_leaf(e)&&
f.is_closed(e)&&f.open_node(e);0!=e.data.Docs&&b(f,e)}).off("keydown");return{Bind:function(a,c){"search"==a&&(b=c)},Tree:function(){return l}}}(),v=$("#idDocsView"),y=function(){var a=[],l=0,f,e,g;return{Update:function(h,d,k){l++;a=[];f=d;e=k;g={};if(h){var m=[],t={};g=t;for(var u=0;u<h.length;u++){var q=h[u],r=q.Id;a.push({Id:q.Id,Name:q.Name});t[r]=q;m.push("<p id='k-view-"+r+"'><span class='glyphicon glyphicon-wrench kBtnSpan' data-id='"+r+"'></span><span class='glyphicon glyphicon-remove kBtnSpan' data-id='"+
r+"'></span><a target='_blank' href='/Document/Index?id="+r+"'>"+q.Name+"</a></p>")}h=$(m.join(""));v.html(h);var p=function(a){b&&(b=!1,$.ajax({url:"/Document/AjaxRemove",type:"POST",dataType:"json",data:{id:a}}).done(function(b){0==b.Code?($("#k-view-"+a).remove(),b=d.Tree(),--k.data.Docs,b.set_text(k,k.data.Name+"&nbsp;&nbsp;&nbsp;&nbsp;["+k.data.Docs+"]")):n.Show(c["err.title"],b.Emsg)}).fail(function(){n.Show(c["err.title"],c["err net"])}).always(function(){b=!0}))};h.find(".glyphicon-wrench").click(function(a){a=
"/Document/Edit?id="+$(this).data("id");window.open(a)});h.find(".glyphicon-remove").click(function(a){var b=$(this).data("id");A.Show(c["msg warning"],c.erase+" - "+t[b].Name+"<br>"+c["sure?"],function(){this.Hide();p(b)})})}else v.html(c["none data"])},Sort:function(){if(0!=a.length){var b=this;m.Show(a,function(a){var k=l,d=a.join("-");$.ajax({url:"/Document/AjaxSort",type:"POST",dataType:"json",data:{sort:d}}).done(function(d){if(0==d.Code){if(k==l){d=[];for(var h=0;h<a.length;h++)d.push(g[a[h]]);
b.Update(d,f,e)}}else n.Show(c["err.title"],d.Emsg)}).fail(function(){n.Show(c["err.title"],c["err net"])})})}}}}(),z=null;x.Bind("search",function(a,d){b&&z!=d.id&&(b=!1,z=d.id,a.set_icon(d,"/public/img/throbber.gif"),$.ajax({url:"/Tag/AjaxGetDocs",type:"POST",dataType:"json",data:{tag:d.id}}).done(function(a){0==a.Code?y.Update(a.Data,x,d):n.Show(c["error title"],a.Emsg)}).fail(function(){n.Show(c["error title"],c["err net"])}).always(function(){b=!0;a.set_icon(d)}))});var B=$("#idDocsHide");$("#kBtnIcon").click(function(a){v.toggle("fast");
B.toggle("fast")});$("#kBtnIconSort").click(function(a){y.Sort()})};
