var NewContext=function(u){var a=u.Language,p=$("#idViewMsg"),f=function(k,d){var a="<div class='alert ";p.html((1==d?a+"alert-info":2==d?a+"alert-warning":3==d?a+"alert-danger":a+"alert-success")+("' role='alert'>"+k+"</div>"));p.show("fast")},q=function(){p.hide("fast")},v=function(){var a=$("#idBtnModalMsg"),d=$("#idModalMsgTitle"),w=$("#idModalMsgBody"),f=$("#idModalMsgSure"),l=$("#idModalMsgCancel"),e=null,r={Show:function(c,b,g){g&&(e=g);d.html(c);w.html(b);a.click()},Hide:function(){l.click()}};
f.click(function(c){e?e(r):l.click()});return r}(),x=function(){var k=$("#idBtnModal"),d=$("#idModalParentWait"),f=$("#idModalParentTree"),n=$("#idModalParentSure"),l=$("#idModalParentCancel"),e=null;n.click(function(d){e&&(d=f.jstree(!0))&&(d=d.get_selected(),(d=d[0])&&""!=d?(e(d),l.click()):v.Show(a["err err"],a["err no set pid"]))});return{Show:function(a,c){c&&(e=c);k.click();d.show();f.hide();var b=f.jstree(!0);b&&b.destroy();f.jstree({plugins:["sort","conditionalselect"],conditionalselect:function(){this.deselect_all(!0);
return!0},core:{data:a}}).on("ready.jstree",function(){d.hide();f.show()})}}},y=function(){var a=$("#idBtnSort"),d=$("#idModalSortBody");d.sortable().disableSelection();var f=$("#idModalSortSure"),n=$("#idModalSortCancel"),l=null,e=null;f.click(function(a){n.click();if(l){var c=[],b=!1;d.children("li").each(function(d,h){var a=$(h).data("id");c.push({Id:a,Sort:d});b||a==e[d].Id||(b=!0)});b&&l(c)}});return{Show:function(f,c){e=f;l=c;for(var b="",g=0;g<f.length;g++)var h=f[g],b=b+("<li class='list-group-item' data-id='"+
h.Id+"'>"+h.Name+"</li>");d.html(b);a.click()}}}();(function(){var k=!0,d=function(c){k=c?!0:!1},p=x(),n=$("#idTree"),l=function(c){var b=[],d=n.jstree(!0);e(d,b,c,"0");return b},e=function(c,b,d,a){if((a=c.get_node(a))&&a.id!=d){var f=!1;"0"==a.id&&(f=!0);b.push({id:a.id,parent:a.parent,text:a.text,state:{opened:f}});if(!c.is_leaf(a))for(a=a.children,f=0;f<a.length;f++)a[f]!=d&&e(c,b,d,a[f])}},r=function(c,b){k&&(d(!1),c.set_icon(b,"/public/js/jstree/themes/default/throbber.gif"),q(),$.ajax({url:"/Tag/AjaxRemove",
type:"POST",dataType:"json",data:{id:b.id}}).done(function(a){0==a.Code?c.delete_node(b):f(a.Emsg,3)}).fail(function(){f(a["err net"],3)}).always(function(){c.set_icon(b);d(!0)}))};n.hide().jstree({plugins:["conditionalselect","contextmenu","sort"],conditionalselect:function(){this.deselect_all(!0);return!0},sort:function(c,b){var a=this.get_node(c),d=this.get_node(b);return a.data>d.data?1:-1},contextmenu:{items:function(c){if(k){var b=this,g=c.id,h=null;1<c.children.length&&(h={label:a.sort,icon:"/public/img/sort_16px.ico",
separator_before:!0,separator_after:!1,action:function(e){if(k){e=[];for(var t=0;t<c.children.length;++t){var g=b.get_node(c.children[t]);e.push({Id:g.id,Name:g.text})}y.Show(e,function(e){if(k){d(!1);b.set_icon(c,"/public/js/jstree/themes/default/throbber.gif");q();var g=JSON.stringify(e);$.ajax({url:"/Tag/AjaxSort",type:"POST",dataType:"json",data:{str:g}}).done(function(a){if(0==a.Code){for(a=0;a<e.length;a++){var d=e[a];b.get_node(d.Id).data=d.Sort}b.close_node(c);b.sort(c);b.open_node(c)}else f(a.Emsg,
3)}).fail(function(){f(a["err net"],3)}).always(function(){b.set_icon(c);d(!0)})}})}}});var e={label:a.create,icon:"/public/img/add_16px.ico",action:function(e){if(k){var g=c.id,h=c.children.length;d(!1);b.set_icon(c,"/public/js/jstree/themes/default/throbber.gif");q();var m=a["new tag"];$.ajax({url:"/Tag/AjaxCreate",type:"POST",dataType:"json",data:{pid:g,name:m,sort:h}}).done(function(a){0==a.Code?(a=b.create_node(c,{id:a.Value,parent:g,text:m,data:h}),b.edit(a)):f(a.Emsg,3)}).fail(function(){f(a["err net"],
3)}).always(function(){b.set_icon(c);d(!0)})}}};return 0==g?{create:e,sort:h}:{create:e,sort:h,edit:{label:a.edit,icon:"/public/img/why_16px.ico",separator_before:!0,separator_after:!1,action:function(a){k&&b.edit(c)}},move:{label:a.move,icon:"/public/img/info_16px.ico",separator_before:!0,separator_after:!1,action:function(e){k&&(e=l(g),p.Show(e,function(e){if(k&&e!=c.id){var g=b.get_parent(c);if(g!=e){g=e;e=c.id;var h=b.get_node(g);h&&(d(!1),b.set_icon(c,"/public/js/jstree/themes/default/throbber.gif"),
q(),$.ajax({url:"/Tag/AjaxMove",type:"POST",dataType:"json",data:{id:e,pid:g}}).done(function(a){0==a.Code?(b.cut(c),b.paste(h),b.open_node(h)):f(a.Emsg,3)}).fail(function(){f(a["err net"],3)}).always(function(){b.set_icon(c);d(!0)}))}}}))}},erase:{label:a.erase,icon:"/public/img/close_16px.ico",separator_before:!0,separator_after:!1,action:function(d){k&&(d="<p>"+a["erase tag"]+" - "+b.get_text(c)+"</p><p>"+a["sure?"]+"</p>",v.Show(a.warning,d,function(a){a.Hide();r(b,c)}))}}}}}},core:{check_callback:!0,
data:u.Data}}).on("ready.jstree",function(){$(this).show()}).on("rename_node.jstree",function(c,b){var e=$(this).jstree(!0),h=b.node,l=b.text,m=b.old;l!=m&&(k?(d(!1),e.set_icon(h,"/public/js/jstree/themes/default/throbber.gif"),q(),$.ajax({url:"/Tag/AjaxRename",type:"POST",dataType:"json",data:{id:h.id,name:l}}).done(function(a){0!=a.Code&&(f(a.Emsg,3),e.set_text(h,m))}).fail(function(){f(a["err net"],3);e.set_text(h,m)}).always(function(){e.set_icon(h);d(!0)})):e.set_text(h,m))});return{}})();return{}};
