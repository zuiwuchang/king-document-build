var NewContext=function(r){var e=r.Language,n=$("#idViewMsg"),h=function(k,a){var e="<div class='alert ";n.html((1==a?e+"alert-info":2==a?e+"alert-warning":3==a?e+"alert-danger":e+"alert-success")+("' role='alert'>"+k+"</div>"));n.show("fast")},p=function(){n.hide("fast")},t=function(){var e=$("#idBtnModalMsg"),a=$("#idModalMsgTitle"),u=$("#idModalMsgBody"),h=$("#idModalMsgSure"),l=$("#idModalMsgCancel"),g=null,q={Show:function(c,b,f){f&&(g=f);a.html(c);u.html(b);e.click()},Hide:function(){l.click()}};
h.click(function(c){g?g(q):l.click()});return q}(),v=function(){var k=$("#idBtnModal"),a=$("#idModalParentWait"),h=$("#idModalParentTree"),m=$("#idModalParentSure"),l=$("#idModalParentCancel"),g=null;m.click(function(a){g&&(a=h.jstree(!0))&&(a=a.get_selected(),(a=a[0])&&""!=a?(g(a),l.click()):t.Show(e["err err"],e["err no set pid"]))});return{Show:function(e,c){c&&(g=c);k.click();a.show();h.hide();var b=h.jstree(!0);b&&b.destroy();h.jstree({plugins:["sort","conditionalselect"],conditionalselect:function(){this.deselect_all(!0);
return!0},core:{data:e}}).on("ready.jstree",function(){a.hide();h.show()})}}},w=function(){var e=$("#idBtnSort"),a=$("#idModalSortBody");a.sortable().disableSelection();var h=$("#idModalSortSure"),m=$("#idModalSortCancel"),l=null,g=null;h.click(function(e){m.click();if(l){var c=[],b=!1;a.children("li").each(function(f,d){var a=$(d).data("id");c.push({Id:a,Sort:f});b||a==g[f].Id||(b=!0)});b&&l(c)}});return{Show:function(h,c){g=h;l=c;for(var b="",f=0;f<h.length;f++)var d=h[f],b=b+("<li class='list-group-item' data-id='"+
d.Id+"'>"+d.Name+"</li>");a.html(b);e.click()}}}();(function(){var k=!0,a=function(c){k=c?!0:!1},n=v(),m=$("#idTree"),l=function(c){var b=[],a=m.jstree(!0);g(a,b,c,"0");return b},g=function(c,b,a,d){if((d=c.get_node(d))&&d.id!=a){var e=!1;"0"==d.id&&(e=!0);b.push({id:d.id,parent:d.parent,text:d.text,state:{opened:e}});if(!c.is_leaf(d))for(d=d.children,e=0;e<d.length;e++)d[e]!=a&&g(c,b,a,d[e])}},q=function(c,b){k&&(a(!1),c.set_icon(b,"/public/js/jstree/themes/default/throbber.gif"),p(),$.ajax({url:"/Tag/AjaxRemove",
type:"POST",dataType:"json",data:{id:b.id}}).done(function(a){0==a.Code?c.delete_node(b):h(a.Emsg,3)}).fail(function(){h(e["err net"],3)}).always(function(){c.set_icon(b);a(!0)}))};m.hide().jstree({plugins:["conditionalselect","contextmenu","sort"],conditionalselect:function(){this.deselect_all(!0);return!0},sort:function(c,b){var a=this.get_node(c),e=this.get_node(b);return a.data>e.data?1:-1},contextmenu:{items:function(c){if(k){var b=this,f=c.id,d=null;1<c.children.length&&(d={label:e.sort,icon:"/public/img/sort_16px.ico",
separator_before:!0,separator_after:!1,action:function(d){if(k){d=[];for(var f=0;f<c.children.length;++f){var g=b.get_node(c.children[f]);d.push({Id:g.id,Name:g.text})}w.Show(d,function(d){if(k){a(!1);b.set_icon(c,"/public/js/jstree/themes/default/throbber.gif");p();var f=JSON.stringify(d);$.ajax({url:"/Tag/AjaxSort",type:"POST",dataType:"json",data:{str:f}}).done(function(a){if(0==a.Code){for(a=0;a<d.length;a++){var e=d[a];b.get_node(e.Id).data=e.Sort}b.close_node(c);b.sort(c);b.open_node(c)}else h(a.Emsg,
3)}).fail(function(){h(e["err net"],3)}).always(function(){b.set_icon(c);a(!0)})}})}}});var g={label:e.create,icon:"/public/img/add_16px.ico",action:function(d){if(k){var f=c.id;a(!1);b.set_icon(c,"/public/js/jstree/themes/default/throbber.gif");p();var g=e["new tag"];$.ajax({url:"/Tag/AjaxCreate",type:"POST",dataType:"json",data:{pid:f,name:g}}).done(function(a){0==a.Code?(a=b.create_node(c,{id:a.Value,parent:f,text:g,data:parseInt(a.Str)}),b.edit(a)):h(a.Emsg,3)}).fail(function(){h(e["err net"],
3)}).always(function(){b.set_icon(c);a(!0)})}}};return 0==f?{create:g,sort:d}:{create:g,sort:d,edit:{label:e.edit,icon:"/public/img/why_16px.ico",separator_before:!0,separator_after:!1,action:function(a){k&&b.edit(c)}},move:{label:e.move,icon:"/public/img/info_16px.ico",separator_before:!0,separator_after:!1,action:function(d){k&&(d=l(f),n.Show(d,function(d){if(k&&d!=c.id){var f=b.get_parent(c);if(f!=d){f=d;d=c.id;var g=b.get_node(f);g&&(a(!1),b.set_icon(c,"/public/js/jstree/themes/default/throbber.gif"),
p(),$.ajax({url:"/Tag/AjaxMove",type:"POST",dataType:"json",data:{id:d,pid:f}}).done(function(a){0==a.Code?(b.cut(c),b.paste(g),b.open_node(g)):h(a.Emsg,3)}).fail(function(){h(e["err net"],3)}).always(function(){b.set_icon(c);a(!0)}))}}}))}},erase:{label:e.erase,icon:"/public/img/close_16px.ico",separator_before:!0,separator_after:!1,action:function(a){k&&(a="<p>"+e["erase tag"]+" - "+b.get_text(c)+"</p><p>"+e["sure?"]+"</p>",t.Show(e.warning,a,function(a){a.Hide();q(b,c)}))}}}}}},core:{check_callback:!0,
data:r.Data}}).on("ready.jstree",function(){$(this).show()}).on("select_node.jstree",function(a,b){var c=$(this).jstree(!0),d=b.node;!c.is_leaf(d)&&c.is_closed(d)&&c.open_node(d)}).on("rename_node.jstree",function(c,b){var f=$(this).jstree(!0),d=b.node,g=b.text,l=b.old;g!=l&&(k?(a(!1),f.set_icon(d,"/public/js/jstree/themes/default/throbber.gif"),p(),$.ajax({url:"/Tag/AjaxRename",type:"POST",dataType:"json",data:{id:d.id,name:g}}).done(function(a){0!=a.Code&&(h(a.Emsg,3),f.set_text(d,l))}).fail(function(){h(e["err net"],
3);f.set_text(d,l)}).always(function(){f.set_icon(d);a(!0)})):f.set_text(d,l))});return{}})();return{}};
